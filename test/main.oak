#!/usr/bin/env oak
// standard library tests

std := import('std')
test := import('test')

// when adding a stdlib here, also add to Makefile/test-js to get JS coverage
TestRunners := [
	'std'
	'str'
	'math'
	'sort'
	'fmt'
	'json'
	'datetime'
	'path'
	'cli'
	'md'
	'syntax'
]

// allow selection of tests to run with CLI arguments
TestsToRun := if len(args()) > 2 {
	true -> std.slice(args(), 2)
	_ -> TestRunners
}

t := test.new('Oak stdlib')

TestRunners |> std.each(fn(name) if TestsToRun |> std.contains?(name) {
	true -> {
		runner := import(name + '.test')
		runner.run(t)
	}
})

t.reportFailed()
t.exit()

